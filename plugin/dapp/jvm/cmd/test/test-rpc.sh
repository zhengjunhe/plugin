#!/usr/bin/env bash
#shellcheck disable=SC2128
#shellcheck source=/dev/null
set -x
source ../dapp-test-common.sh
#source /home/lyh/go/src/github.com/33cn/plugin/build/dapp-test-common.sh

code="0x504b03041400080808007c6f5451000000000000000000000000090004004d4554412d494e462ffeca00000300504b0708000000000200000000000000504b03041400080808007c6f5451000000000000000000000000140000004d4554412d494e462f4d414e49464553542e4d46f34dcccb4c4b2d2ed10d4b2d2acecccfb35230d433e0e5722e4a4d2c494dd175aa040958e819c41b9919e966e695a416e525e62868b8955625e6a6666af272f92666e6e93ae72416175b2924e7e7eaa54164f492338012c6c67ae9a5a9c5c57aee2092978b970b00504b07085d042b626800000070000000504b03041400080808007c6f545100000000000000000000000025000000636f6d2f66757a616d65692f636861696e33332f67756573732f47756573732e636c6173739d580b7c94d595ff9f6466be99c9970049080e204c0025641282800402f27e05424002a4406d1d265f9291c94c9c9920b8dd6ebb42754bb5abd5567cd49656682d2da03004a9afaab075ad56bb6e1f5bb7aeb6dd76db75dbdd76abc863ffe79b6ff2c041f92d24f771eeb9e79ec7ff9c7bbfbc70eef127014c97cd7e74639f0f6eecf7b3f98636df34f08817293fbe85037e7c1bdf3170d00f1ff6e9e23edd7048a78775d7a37e3c86233a3aea4706c774d4abcd713f6af1b8362794e5bb069ef06344f6a827b5794a9ba795e11995f63d3de9593df33915f4bc9e75d28b533af90703dff763025e5009ffa8cd8bbaef076ed8ff260ef5e325bcaccd0f0dbc62e0553f7e847fd2e6356dfe599b93067eecc734ecf3e227daff549b9f69f38c23067e2ffe458ffbb91f93f1ba36ffaa3afe429b37f4d47f2bc29b78ab08bfc4afb4f9b581df1461097e9713e051157eafa4ffd423dff6e3bff0071dfdd18bffce31b97383b6dc60bc1ef53f5edca3fd9fbcf8a217f7abf97ff6e27fd5cebfe8e41d6ddef5e2b417ef7971c68bb32af89caa75de2ba021225e29f04a21e9e2f28adb2b1eaf185ef17ac5e715bf2145026f6373cbba05cd8b96082a9b2289aebaf69e9bc35d56b42ed2198ec6a74dabebe8b152a9ba65dace16f89ac2a9f4da444fbc4d50da7443785bb82e168e77d4b5a493d17807198a1725e2a974389ede108ef558f63c1a5f93b422d154341117c80a41111992e9e556b4a3334d9156bc2d3776b585d36141202bb9271d8dd53545e35badb6e5e154e7aa70b76ad012ed8887d33d490a8f5f8c6fce00d51ae369abc34acebe145ec78c3cbbe7f2bfc01d6eeb8ad20a6f34b528964859f442d900e6858944cc0ac7c9e88df544b6ee68eee91acc90934649c9ac137d5b12f19ed41a6ea45f62564738b263a152049e39d178343d5750583569035db328d146938750778b72b758c975e12d31528a3aac74a3edf30867f5559bf39c37e912425bdc920e47b6d2218e5c6f2c116e5b6cc7637cd5870b6089609eb130086654fd3f55f0a6c2dbacec91347a13bd63236519b770b13b16de911d4eca7740be3337b0c868011093b2221a311560483113555090de2ea818e4300700ea70f78d3d567287a02a2f431e9a2125d4724e24e6c4cddf92e84946aca551f5a6dfb671b26e32f119dc6ae246244ddc8e3bb4b94b30f643dc63c8105386ca30434a4d2993618272ddd1914874c4acba8e54225eb78c8d29e532dc940a1961e26ff029432e332580bb4d7c126943469a324a469bd88e9b4cdc82bf35e5721963ca58096a532918719124317133fecac42eddb7938d8c93f1a64c902b4cb952269a52a5cd24d2f005dc2d189deeb4821d3425d8194ec527a683761cadb6e00e2b5d694ab58468f08078c514f93102306d2dd91eb1bad3ac157493d498522b934da99329a65c25a30d996aca34996ecad5324330ec7d21170cbd302e0cbe89cf4abd29336596290d323b67e600a6853dd1589b6ebf3cc6240826da835bc231cda8ca60dca2dee12ea66bbac19439728d360cef153b123d346f9b154c27823785a3e9607b2219bc6a4a704b2c41119d7649a3b1f3d453f3d5cd0b64a1894fd3ebd8a12e5c248b0d5962ca525946449ab29c6192465961c84a568dfe40d0fd1396c4d38a45b7d39b8df1b8955c140ba75256ca94265961ca2a99614ab38e56cb2c43d66844af3565adda5bb98ef1684f266eb6e241bbe004a3fc89a77adadba391a815573d5b54c575b2dec43d1ac2c0c0e5607738c968d2c7c954a50ade60e28bf89289fb712b2f82f5f1adf1c44df1607b4f3cd24cbe86a06038cb920ddcb55624916c5bb8c3b93586906e57b83eca30529a582e59d51c9a89f7a4d5948fc818a6ad9d035cb3fdbe91f5ae261d8d6cb5d24a1218cd091ad29e30714658303c7659557a8d6d27473ec5623277b862329e4807adedd1549a80f7d5c4b24793b398b2ecb21ecc969901505abde5062bc20b2a78f12ccdda496ff447ae91fe0aa7138455599e7a2118954f5a5322128e2d5e98f5cbd264a2cb2634c6b94b7065559e5a74c9a2ed041b28da2638a2bda4d988a2b6550365da44adce0450d78a94dee2f579d478df8e8132b2fe9b3d28659ddb9268de921d394f8631f9545fa849654f1817d5b42799241e730f075e172bf45aee7b7790d048146cd3d9ea762df38d93f25ec415559b26e5bfc2d389ac65acb455797dec4927b2ee181415c7d4bc3b8a53567aa0cf277eb01f7301de94dd3910088613412a974a27bad725c3f1546b34ddb924996c643a30fff22165d345e8bcee0a29f0c32de98b6361770fd967e661bf4401be5822dee1042b2f581744225a73090f6bbb15b10d6cd70a5d75493e5ba1b6fa75e752bbec69a02fc2559ff782ff80e74a36d36943c9e01a47437240c9fb742d495dc03ebaeaa2dc1a124fb8bbdbd2b2557b4959efdc61b355ee8a0f5af651edb5e1789ba2c713b3e21de94e0e68637281bec199298b087f4baf9a1605c5b0415691a4481e44d0d4ebab751583d87335907b0c3e069aaded7a46dcee06e7551f3406c8a62bb295c9418a1dd1059174741b271ed2575a3bb27158938cde6ce51c5bd22fb529a1195c36d8234a740232689f971a76661fda1eebc69e702c7541c2e410bd297feee62f3193f3bf872f0e14578a3a5d10f68b9695feb85ef101e7f49b8d4a7e3776f32bd3c4487d847214400a69087a382e8087f36db8a96f3e89bf7c30dae31d4ecfd720d73f618fff9abf7c5dda633e39ed9eaf1cbbbfc5e9773afb76d97d11f7f20dccf636ce2e672ffa1d5c7d0c729803c1dfe9b7b34d34b1079fc56e87751e0a6d6a45f593f7c1ff280a32283cc4aeba706a06ae43f611bab7847cc0501a3a8c12caf039ceb8d3e466beb8b3c2c4808b870077947a7a6134854e6257a817de553527f18913f06d3c067f736dcd09b8392acac0cca0f869b81b5c01d711946430640fd63a8b0dee805ba9438f6268c0dd8b6147519aa5946550eebabe17c38fa22ce02eec45c5519404dc273082fb2e3b8a40966de4518c0ab80f055c87a4df88a5541ea8a18eb5d03f040cc1149a721546612aea300d0d988e45b81aab3003eb518f0ecc645c67312a0df4ee6ccab88686cfb78d1f8582f324b80d7cdec0dfdb3f77720cbcc3c3d42977391eeea053f4cf10b5a10c463bde18f7c1de18a8f348dba38be1a5f62696a11ccb51854684b0d2d6c30b398310cfe771fc52700e6de56e17fb3ae7a0a650750697afaab6fd37baa617635a4b3dceac1763e9c5e65a06e0401f562a6c9d5753fc1ac67e2dd558876a3a45f42deb1cb29b0850542ca0ecc2a6d029cc728c59c503828c5c4d367035ae6cb86a9c68d5f407ab2683ca03ae037dd656332ec0261ebe193e7c94f1ba0e97e163188b8f6322ae6794c28cc516c2d6eab77e9efa5df4f99c55ace036ee2fa625bb54b1e6da53282b1dd78bf1ad27306163e9b863b8e2a9da2308301e573e8d110d2e09b8f66184a35483cb5e0bb83298d84af5aaca31295a4f08061b8c80c1b5a1159c84f6e02fb971cd1efcae76e3118caa70871575ae80614bae6df006bc273136e0256429a95c514b1ad79534b1753f4c9dd4e898deaf6c753d81c91b0b03464b2fea1a7c015f06531afc017fad1d275bd7a240d1294cc9a96a06cc90bd3bcb1330edb12fe0cfe02add3d9547ac0e14851c75c87e126394ab5f1d93cbd97dfb41e183c415bd4fdce11398c693a7975e9dc18c0a7706f519cccc7936df9afaba2fb87b095c20cae0dcc0e06e65fac55818e3b8120926653713ef4626570a2b58fa56b3545ec7a21965794bb3587e8a8572178be4dd2c935f65817c8485f120a94fb0303ec792f82a0be38f5914df20d76f98ac7f62317c0fb709d12c2e7eac0ec16e29c7e7643c6e973a7c5eea71a72cc25db2025f9035b847aec5bd126565545035c277060182ea0cae3470ef395cefb2f37b8ff71c361ab88f34fe9c413549c6695c769e7b0cbb0eecb17f38b85777d8c9747fae2a17bc46c38790f46a2e5dde874aa6cb8260e8084aad72ccbafb4132ccee6398ad0c851a3257e10cf770e26e4e06d7ecc538456a3967c3e9f2b95ccf45d6b5d32dfbcfffd45e1eeaef56923b14701fc53c9ec02ae920ca13f09cc2981069a38e626488693b3fe4cae669483179d8576f043c192c380e7ee6282a8f838f993d98a0a3c582a7b1a4c15f6104fcc7b15467447255b8ded87ffe2779b73d30709b9e5a8e65519adb354840b4c2e8aa2f0a698615f5a2710fd6eb58595628cb64a53207e73919d347b733a738509cc1ca869240093795296b938de4e2002f9955bac8c438df5ddadce7dc66756e5699d554e6daae7a9f7db68f67b786b20b2df6427e1ff541fc510219789091fe3221fe10e3fd15427c2f6fe4afb1b67d9df7cdc3ac5fdf20ccbf896682b8837d170e10d8df2698bfc39bf420abf821a2e630773e4acec7b872842b19528ee147e8c5af709c107f5cfc784226e149b91a4fc94a3c23617c4f3af1acdc84e7e493785e76e2a4dc8aefcbed7841be841fc8c378490ee265790a3f94e7f08abc8857e5154a54c8cf823f07f9a0eb2cbcc4b19cc6a4b3986f23fadeb32821a21f388dea3328e2e02cee32f0a0eb1d1ae8a3a90f390f806a1aaed7cef3ce45d0c467c4aa82b92c2aebbf053bb3f86af8f4905bf46933eeadfa37b5d8cf4dfcf9cea5eca7d4946ec8a0750f2a0be7eee71d55fa117b56e6e2aca4a674a33d73bbe75efe48f64ffa2b9d3fed17f077347f27e835c9706c62255b56fda4e721f84b376b840f87aa5d537bf1d16ab7b6195cb71f13c9f7b1fd080e2c5b1f67d9b25f3d339cbad51fd5197a9be0e7bc6d5e6729fa05cbcf1b8cd69b2c336fd17bbfe465ff6bc6fcdf19b1df32c6ff81fdf83d8bd2dbb66747c07f0ed3b3af04292ef68f36cc52cfbbd4d847f6af3aa5e10ff49b8ffefba3ad77b18dc9cdaa4316dfd45f817da137b33e287c627fd34beca7feecd9dd4bd40f6ba333ef653fbfa6f4fa41fe0c0ff2e7960bfc299b2ff0e75efebe1eca392d625f930fa353eb491bb56a7017cef0e8c4c9705e8e4e862fd49193e1de807bb827e7618bbe0d78ed54cda0bdb4c3992eb5a7747acb4e0f2bd6e37cb6b9ec03f8bc2bed6ce99bf6e91265d17217e6a4dea0717356da4bb7aa508f23af6fab3e681d16976a7a0a130748880d92d09545806e0e18d977a9eb2ba8bbe889713d918cf3fa0f55c5132d03edc80b32e5e8c3d867f81501bccbd7de693eb3cf600ccef206398f07f83adfcb6bec8014e0a014326f5d38276e11f1884b0cfef749b1f8a54c8aa44286c868192a55324c9aa554ae95726995e16271e5061921bbe532b94346ca7d324a9e25e74919232fca5879592ae53519276ff37a54cc865132f41c66db575d16b4e759bd5814f63a24fb06dccbee0150dde5efa2e0344a1ace63ce40267008fb495c7f9ea9e31ab0a20fb7aff57dae8cb731c78f18a76a3c86820b3f5a8ac9f275db570f33bfc057a2600933eeb71edfff01504b0708eb2cd6296b0f0000681d0000504b03041400080808007c6f545100000000000000000000000026000000636f6d2f66757a616d65692f636861696e33332f67756573732f5265636f72642e636c617373b5566953db56143d0213811090400265c9ce626c835348430a94841d13db104c6993346d852d8cc148c40b9de68f74d2dfd00f7473983293e15333d3dfd4e9f43c59c60b2221cc6418eebbefea2ee75e9df7e47ffefbeb0d80bbf8414127027550b028c42321824284148ab0104b0a96f158c10a223256852520c49732d614342020e32b054dc2d889af85f64488a722e09970fc46783d17dab70a3af09dd87e2f4393b12ea136108eac4e86a76725dc0a46cd1dff46f6a5b6a327fcd14d2d610c0ffbe3593d9df6afe85133151b93206bb1588a1609cdc12d6d4ff3273523ee8f64520923cec7f5967bde5b427bde259b4924fdc184b1adc716b4f46648dba5675d241137b44c36a54b304ff31b2fa91130327a5c4f8d7db86f9969827fc4b99b4abcd40b3827ce993368b26991eec278c24864262454bbfbd724b8a6cd18db6a622e3d9cdd59d753abda7a921625ae67260b03bcecee771aa1922ef1b9e23ee9222a3432d17ce9a83b0bc91c87fde2f4a71f6dc48de90a885dee53118a9652a73efe48100b735c2ea5c2c3f34caa9c0ca2f1b29c93e7e8ac34a5005a4fa001239dd18c287934e27ee6c08bb39cdf8648468b6eb3b4cdc8daa4a9c566b48c26a1db7d860c32a212ee39b1f22cd56bd3da9e9eafc693f294fc2ee7f1d48f2b66d6e0c806dd0e937917c3d73e28e0cc2ce12126c229d3c8a68fb1f5bca354f1b5b1d9f168d2be169488994d45f5b98418797dbed74111a0a2177d2aaee1ba8a1bb8a9a25b882e5c55318671212664c454e8f0cad85011c7a6841bef9bb40a1f0624b49dd23daf1e91216e9af1a4ee8fa74dc33f4fa122812d15db48aad801b72676550cc2afe205522a3f56d4d2c8a8c8628f342f6f58c2c5a261697d4b8f66ca4c799a48b8e6047e2a6946b7ad0dbf301cf85ccadce19de6e41a34a35a72664ac225dbcf32040ce697d0eb484c874bb696c1d3494d5cb12d65d7b065140e1b4cbdc8a988c37632c38988d21cf9eec5672163e65394e1b21f3be26ae0dd51da50dfbb6b175ae449aa6647ef2f740c4dded392597d6943f4bfe8405e95e9965233fa86964d32ef7d87bc67aa849b10bf4b00177f7a90d7d4aa04ddad958c077f7758fa6dfe7797ec7bd0489da783d24dcb55ae12d71acf6b48bf5291d04f79c132d6517ae03de1fa07aaf62b5c9b29793a6cd75bac54259e79bc7fa2aa9856b1acada8411b2d3c03dc57a6aeae4cdd6143bfc3dda718b243ca4a545796b8c612d7edb8613eb9eb58ca5559ea961df21977f79c4bb92a4bf5b2549f1d378257b88fcfed293c40b595b5d5f3e66728bfa126870bfb5c3cd54339c8fb5684c8d3483f70d0351cb5ca198e72c74895c1bcadec64aff8aa5d5c970e507b80baa0f72d3c87509ebc467dc8475b0eaaef100ddc37721e45d5e5db3f4413f58b219fd70ec8e1520ecd4750c20345141ef603f62c7358f59c400b27d0c18e7ad8d11df6344430a38413c21716c25a48ff6248e64ec09cb061fe4490355c435e820cf9dec26dd70c0f780971a008b1a8ba060a10c303be4a88a3ae765725c8499698263b677009b3a4d31c093e4ffa2d90528b84fd88325804399807f9000f6d9023cc2646de66970d7a3d39b48404af39cacbbf1cbfe1fc9b59669ac7d423b44e62ca6645b7cd0a95b157d85beb111a2af9f4dce6c5347733849a2f3fcb1989c82e46b6fd8d16b178eb0ef0490eed47e8d8176a253be27c2f9b3c355b0576b411d4dcf131be6d2504eaedf1fd8e9acac3ac50ce5b5917fe07504b07085607bbf9f3040000270d0000504b010214001400080808007c6f54510000000002000000000000000900040000000000000000000000000000004d4554412d494e462ffeca0000504b010214001400080808007c6f54515d042b62680000007000000014000000000000000000000000003d0000004d4554412d494e462f4d414e49464553542e4d46504b010214001400080808007c6f5451eb2cd6296b0f0000681d00002500000000000000000000000000e7000000636f6d2f66757a616d65692f636861696e33332f67756573732f47756573732e636c617373504b010214001400080808007c6f54515607bbf9f3040000270d00002600000000000000000000000000a5100000636f6d2f66757a616d65692f636861696e33332f67756573732f5265636f72642e636c617373504b0506000000000400040024010000ec1500000000"
contract="user.jvm.Guess"
#privkey="CC38546E9E659D15E6B4893F0AB32A06D103931A8230B0BDE71459D2B27D6944"
privkey="0x4257d8692ef7fe13c68b65d6a52f03933db2fa5ce8faf210b5b8b80c721ced01"
jvm_privkey="0x7b2800cdecd978ab0e877f7e3734b9d0b11d864fa51d9b623d7bdbd76c16a40d"
MAIN_HTTP=""
exector="jvm"
#main_addr="14KEKbYtKKQm4wMthSK9J4La4nAiidGozt"
main_addr="12qyocayNF7Lv6C9qW4avxs2E7U41fKSfv"
jvm_addr="1PrTWtT1Bzhg2L8jjVKU7ohxHVXLU4NMEU"

function init() {
    #    cli="/home/lyh/go/src/github.com/33cn/plugin/build/chain33-cli"
    #    #初始化
    #    $cli seed save -p hzjhzj123 -s "hurdle civil burden caught lamp spoon confirm admit plug gate bracket paddle eight merry repair"
    #    $cli wallet unlock -p hzjhzj123
    #
    #    req='{"method":"Chain33.ImportPrivkey", "params":[{"privkey":"'${privkey}'", "label":"opener"}]}'
    #    chain33_Http "$req" ${MAIN_HTTP} '(.error|not) and (.result.label=="opener") and (.result.acc.addr == "'${main_addr}'")' "$FUNCNAME"

    req='{"method":"Chain33.ImportPrivkey", "params":[{"privkey":"'${jvm_privkey}'", "label":"player"}]}'
    chain33_Http "$req" ${MAIN_HTTP} '(.error|not) and (.result.label=="player") and (.result.acc.addr == "'${jvm_addr}'")' "$FUNCNAME"
}

function create_contract() {
    echo "Begin to test contract $contract"

    local req='{"method":"Chain33.CreateTransaction","params":[{"execer":"'"${exector}"'", "actionName":"CreateJvmContract","payload":{"name": "'"${contract}"'","code":"'"${code}"'"}}]}'
    chain33_Http "$req" ${MAIN_HTTP} '(.error|not) and (.result != null)' "CreateJvmContract" ".result"
    chain33_SignAndSendTx "${RETURN_RESP}" "${privkey}" "${MAIN_HTTP}"
    echo_rst "CreateJvmContract query_tx" "$?"
}

function transfer() {
    #转账
    echo "send coins transfer -a 1000"
    chain33_SendToAddress "${main_addr}" "${jvm_addr}" 100000000000 ${MAIN_HTTP}

    echo "send coins send_exec -a 30"
    contract_addr=$(curl -ksd '{"method":"Chain33.ConvertExectoAddr","params":[{"execname":"'${contract}'"}]}' ${MAIN_HTTP} | jq -r ".result")
    #2  存钱到合约地址
    tx_hash=$(curl -ksd '{"method":"Chain33.CreateRawTransaction","params":[{"to":"'"$contract_addr"'","amount":3000000000,"note":"send2exec"}]}' ${MAIN_HTTP} | jq -r ".result")
    chain33_SignAndSendTx "$tx_hash" "$jvm_privkey" ${MAIN_HTTP}
}

function start_game() {
    #开始游戏
    echo "send jvm call -e $contract -x startGame"
    local req='{"method":"Chain33.CreateTransaction","params":[{"execer":"'"${contract}"'", "actionName":"CallJvmContract", "payload":{"Name": "'"${contract}"'","actionData":["startGame"]}}]}'
    chain33_Http "$req" ${MAIN_HTTP} '(.error|not) and (.result != null)' "startGame" ".result"
    chain33_SignAndSendTx "${RETURN_RESP}" "$privkey" ${MAIN_HTTP}
}

function play_game() {
    #投注
    echo "send jvm call -e $contract -x playGame"
    local req='{"method":"Chain33.CreateTransaction","params":[{"execer":"'"${contract}"'", "actionName":"CallJvmContract","payload":{"Name": "'"${contract}"'","actionData":["playGame", "6", "2"]}}]}'
    chain33_Http "$req" ${MAIN_HTTP} '(.error|not) and (.result != null)' "playGame" ".result"
    chain33_SignAndSendTx "${RETURN_RESP}" "$jvm_privkey" ${MAIN_HTTP}
}

function close_game() {
    #转账，增加高度
    for ((a = 0; a <= 12; a++)); do
        echo "$a" tx to transfer
        chain33_SendToAddress "14KEKbYtKKQm4wMthSK9J4La4nAiidGozt" "${jvm_addr}" 100000000 ${MAIN_HTTP}
    done

    echo "close $contract"
    local req='{"method":"Chain33.CreateTransaction","params":[{"execer":"'"${contract}"'", "actionName":"CallJvmContract","payload":{"Name": "'"${contract}"'","actionData":["closeGame"]}}]}'
    chain33_Http "$req" ${MAIN_HTTP} '(.error|not) and (.result != null)' "closeGame" ".result"
    chain33_SignAndSendTx "${RETURN_RESP}" "$jvm_privkey" ${MAIN_HTTP}
}

function query() {
    #查看信息
    #$cli jvm query -e user.jvm.Guess -r "getGuessRecordByRound 1PrTWtT1Bzhg2L8jjVKU7ohxHVXLU4NMEU 1"
    #$cli jvm query -e user.jvm.Guess -r "getBonusByRound 1PrTWtT1Bzhg2L8jjVKU7ohxHVXLU4NMEU 1"
    #$cli jvm query -e user.jvm.Guess -r "getLuckNumByRound 1PrTWtT1Bzhg2L8jjVKU7ohxHVXLU4NMEU 1"
    local req='{"method":"Chain33.Query","params":[{"execer":"'"${exector}"'", "funcName":"JavaContract","payload":{"contract": "'"${contract}"'","para":["getGuessRecordByRound","1PrTWtT1Bzhg2L8jjVKU7ohxHVXLU4NMEU","1"]}}]}'
    chain33_Http "$req" ${MAIN_HTTP} '(.error|not) and (.result != null)' "Query" ".result"

    local req='{"method":"Chain33.Query","params":[{"execer":"'"${exector}"'", "funcName":"JavaContract","payload":{"contract": "'"${contract}"'","para":["getBonusByRound","1PrTWtT1Bzhg2L8jjVKU7ohxHVXLU4NMEU","1"]}}]}'
    chain33_Http "$req" ${MAIN_HTTP} '(.error|not) and (.result != null)' "Query" ".result"

    local req='{"method":"Chain33.Query","params":[{"execer":"'"${exector}"'", "funcName":"JavaContract","payload":{"contract": "'"${contract}"'","para":["getLuckNumByRound","1PrTWtT1Bzhg2L8jjVKU7ohxHVXLU4NMEU","1"]}}]}'
    chain33_Http "$req" ${MAIN_HTTP} '(.error|not) and (.result != null)' "Query" ".result"
}

function rpc_test() {
    set +e
    set -x
    chain33_RpcTestBegin jvm
    MAIN_HTTP="$1"
    echo "main_ip=$MAIN_HTTP"

    ispara=$(echo '"'"${MAIN_HTTP}"'"' | jq '.|contains("8901")')
    if [ "$ispara" == false ]; then
        init
        create_contract
        transfer
        start_game
        play_game
        close_game
        query
    fi
    chain33_RpcTestRst jvm "$CASE_ERR"
}

chain33_debug_function rpc_test "$1" "$2"
